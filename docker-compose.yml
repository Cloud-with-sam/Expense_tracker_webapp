version: "3.8"

services:
  mainapp: 
   build :
    context: ./
   container_name: "expensesapp"
   environment:
     SPRING_DATASOURCE_USERNAME: root
     SPRING_DATASOURCE_URL: "jdbc:mysql://mysql:3306/expenses_tracker?allowPublicKeyRetrieval=true&useSSL=false"
     SPRING_DATASOURCE_PASSWORD: Test@123
   ports:
    - "8080:8080"
   networks:
    - appbridge
   restart: always
   depends_on:
    - mysql

  mysql:
   image: mysql:latest
   container_name: mysql
   environment:
     MYSQL_ROOT_PASSWORD: "Test@123"
     MYSQL_DATABASE: expenses_tracker
   networks:
   - appbridge
   volumes:
   - ./mysql_db:/var/lib/mysql
   healthcheck:
     test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-uroot", "-pTest@123"]
     interval: 10s
     timeout: 5s
     retries: 5
     start_period: 30s
   restart: always

networks:
  appbridge:

volumes:
  mysql_db:


    